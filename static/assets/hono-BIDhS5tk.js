var S=Object.defineProperty;var C=(e,r,t)=>r in e?S(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var f=(e,r,t)=>C(e,typeof r!="symbol"?r+"":r,t);var g=(e,r,t={})=>{let i=`${e}=${r}`;if(e.startsWith("__Secure-")&&!t.secure)throw new Error("__Secure- Cookie must have Secure attributes");if(e.startsWith("__Host-")){if(!t.secure)throw new Error("__Host- Cookie must have Secure attributes");if(t.path!=="/")throw new Error('__Host- Cookie must have Path attributes with "/"');if(t.domain)throw new Error("__Host- Cookie must not have Domain attributes")}if(t&&typeof t.maxAge=="number"&&t.maxAge>=0){if(t.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");i+=`; Max-Age=${Math.floor(t.maxAge)}`}if(t.domain&&t.prefix!=="host"&&(i+=`; Domain=${t.domain}`),t.path&&(i+=`; Path=${t.path}`),t.expires){if(t.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");i+=`; Expires=${t.expires.toUTCString()}`}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.sameSite&&(i+=`; SameSite=${t.sameSite.charAt(0).toUpperCase()+t.sameSite.slice(1)}`),t.partitioned){if(!t.secure)throw new Error("Partitioned Cookie must have Secure attributes");i+="; Partitioned"}return i},k=(e,r,t)=>(r=encodeURIComponent(r),g(e,r,t)),A=(e,r)=>(e=e.replace(/\/+$/,""),e=e+"/",r=r.replace(/^\/+/,""),e+r),y=(e,r)=>{for(const[t,i]of Object.entries(r)){const a=new RegExp("/:"+t+"(?:{[^/]+})?");e=e.replace(a,`/${i}`)}return e},U=(e,r)=>{switch(r){case"ws":return e.replace(/^http/,"ws");case"http":return e.replace(/^ws/,"http")}},_=e=>/^https?:\/\/[^\/]+?\/index$/.test(e)?e.replace(/\/index$/,"/"):e.replace(/\/index$/,"");function u(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function x(e,r){if(!u(e)&&!u(r))return r;const t={...e};for(const i in r){const a=r[i];u(t[i])&&u(a)?t[i]=x(t[i],a):t[i]=a}return t}var p=(e,r)=>new Proxy(()=>{},{get(i,a){if(!(typeof a!="string"||a==="then"))return p(e,[...r,a])},apply(i,a,n){return e({path:r,args:n})}}),b=class{constructor(e,r){f(this,"url");f(this,"method");f(this,"queryParams");f(this,"pathParams",{});f(this,"rBody");f(this,"cType");f(this,"fetch",async(e,r)=>{if(e){if(e.query){for(const[s,o]of Object.entries(e.query))if(o!==void 0)if(this.queryParams||(this.queryParams=new URLSearchParams),Array.isArray(o))for(const c of o)this.queryParams.append(s,c);else this.queryParams.set(s,o)}if(e.form){const s=new FormData;for(const[o,c]of Object.entries(e.form))if(Array.isArray(c))for(const h of c)s.append(o,h);else s.append(o,c);this.rBody=s}e.json&&(this.rBody=JSON.stringify(e.json),this.cType="application/json"),e.param&&(this.pathParams=e.param)}let t=this.method.toUpperCase();const i={...(e==null?void 0:e.header)??{},...typeof(r==null?void 0:r.headers)=="function"?await r.headers():r!=null&&r.headers?r.headers:{}};if(e!=null&&e.cookie){const s=[];for(const[o,c]of Object.entries(e.cookie))s.push(k(o,c,{path:"/"}));i.Cookie=s.join(",")}this.cType&&(i["Content-Type"]=this.cType);const a=new Headers(i??void 0);let n=this.url;n=_(n),n=y(n,this.pathParams),this.queryParams&&(n=n+"?"+this.queryParams.toString()),t=this.method.toUpperCase();const m=!(t==="GET"||t==="HEAD");return((r==null?void 0:r.fetch)||fetch)(n,{body:m?this.rBody:void 0,method:t,headers:a,...r==null?void 0:r.init})});this.url=e,this.method=r}},O=(e,r)=>p(function t(i){var c;const a=[...i.path];if(a[a.length-1]==="toString")return a[a.length-2]==="name"?a[a.length-3]||"":t.toString();if(a[a.length-1]==="valueOf")return a[a.length-2]==="name"?a[a.length-3]||"":t;let n="";if(/^\$/.test(a[a.length-1])){const h=a.pop();h&&(n=h.replace(/^\$/,""))}const m=a.join("/"),s=A(e,m);if(n==="url")return i.args[0]&&i.args[0].param?new URL(y(s,i.args[0].param)):new URL(s);if(n==="ws"){const h=U(i.args[0]&&i.args[0].param?y(s,i.args[0].param):s,"ws"),d=new URL(h),w=(c=i.args[0])==null?void 0:c.query;return w&&Object.entries(w).forEach(([v,l])=>{Array.isArray(l)?l.forEach(P=>d.searchParams.append(v,P)):d.searchParams.set(v,l)}),new WebSocket(d.toString())}const o=new b(s,n);if(n){r??(r={});const h=x(r,{...i.args[1]??{}});return o.fetch(i.args[0],h)}return o},[]);export{O as h};
